
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-7.3.6">
    
    
      
        <title>(De)serialization - apischema</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a57b2b03.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#4cae4f">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="green" data-md-color-accent="indigo">
  
    
    <script>function __prefix(e){return new URL("..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#deserialization" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="apischema" class="md-header__button md-logo" aria-label="apischema" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            apischema
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              (De)serialization
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/wyfo/apischema/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    wyfo/apischema
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="apischema" class="md-nav__button md-logo" aria-label="apischema" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    apischema
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/wyfo/apischema/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    wyfo/apischema
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../data_model/" class="md-nav__link">
        Data model
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          (De)serialization
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        (De)serialization
      </a>
      
        


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deserialization_1" class="md-nav__link">
    Deserialization
  </a>
  
    <nav class="md-nav" aria-label="Deserialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#allowed-types" class="md-nav__link">
    Allowed types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strictness" class="md-nav__link">
    Strictness
  </a>
  
    <nav class="md-nav" aria-label="Strictness">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#coercion" class="md-nav__link">
    Coercion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-properties" class="md-nav__link">
    Additional properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fall-back-on-default" class="md-nav__link">
    Fall back on default
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strictness-configuration" class="md-nav__link">
    Strictness configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fields-set" class="md-nav__link">
    Fields set
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#serialization" class="md-nav__link">
    Serialization
  </a>
  
    <nav class="md-nav" aria-label="Serialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#type-checking" class="md-nav__link">
    Type checking
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serialized-methodsproperties" class="md-nav__link">
    Serialized methods/properties
  </a>
  
    <nav class="md-nav" aria-label="Serialized methods/properties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    Error handling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-required-serialized-methods" class="md-nav__link">
    Non-required serialized methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generic-serialized-methods" class="md-nav__link">
    Generic serialized methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exclude-unset-fields" class="md-nav__link">
    Exclude unset fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exclude-fields-with-default-value-or-none" class="md-nav__link">
    Exclude fields with default value or None
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-ordering" class="md-nav__link">
    Field ordering
  </a>
  
    <nav class="md-nav" aria-label="Field ordering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#class-level-ordering" class="md-nav__link">
    Class-level ordering
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-level-ordering" class="md-nav__link">
    Field-level ordering
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#typeddict-additional-properties" class="md-nav__link">
    TypedDict additional properties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#faq" class="md-nav__link">
    FAQ
  </a>
  
    <nav class="md-nav" aria-label="FAQ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-isnt-coercion-the-default-behavior" class="md-nav__link">
    Why isn't coercion the default behavior?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-isnt-with_fields_set-enabled-by-default" class="md-nav__link">
    Why isn't with_fields_set enabled by default?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-isnt-serialization-type-checking-enabled-by-default" class="md-nav__link">
    Why isn't serialization type checking enabled by default?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-not-use-json-library-default-fallback-parameter-for-serialization" class="md-nav__link">
    Why not use json library default fallback parameter for serialization?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../json_schema/" class="md-nav__link">
        JSON schema
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../validation/" class="md-nav__link">
        Validation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../conversions/" class="md-nav__link">
        Conversions
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          GraphQL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="GraphQL" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          GraphQL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../graphql/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../graphql/data_model_and_resolvers/" class="md-nav__link">
        Data model and resolvers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../graphql/schema/" class="md-nav__link">
        GraphQL schema
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../graphql/relay/" class="md-nav__link">
        Relay
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/sqlalchemy_support/" class="md-nav__link">
        SQLAlchemy support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/pydantic_support/" class="md-nav__link">
        Pydantic support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/attrs_support/" class="md-nav__link">
        Attrs support
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/subclass_union/" class="md-nav__link">
        Class as union of its subclasses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/subclass_tagged_union/" class="md-nav__link">
        Class as tagged union of its subclasses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/recoverable_fields/" class="md-nav__link">
        Recoverable fields
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/inherited_deserializer/" class="md-nav__link">
        Inherited deserializer
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../performance_and_benchmark/" class="md-nav__link">
        Performance and benchmark
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../difference_with_pydantic/" class="md-nav__link">
        Difference with pydantic
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/wyfo/apischema/releases" class="md-nav__link">
        Releases
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#deserialization_1" class="md-nav__link">
    Deserialization
  </a>
  
    <nav class="md-nav" aria-label="Deserialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#allowed-types" class="md-nav__link">
    Allowed types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strictness" class="md-nav__link">
    Strictness
  </a>
  
    <nav class="md-nav" aria-label="Strictness">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#coercion" class="md-nav__link">
    Coercion
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#additional-properties" class="md-nav__link">
    Additional properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fall-back-on-default" class="md-nav__link">
    Fall back on default
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strictness-configuration" class="md-nav__link">
    Strictness configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fields-set" class="md-nav__link">
    Fields set
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#serialization" class="md-nav__link">
    Serialization
  </a>
  
    <nav class="md-nav" aria-label="Serialization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#type-checking" class="md-nav__link">
    Type checking
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#serialized-methodsproperties" class="md-nav__link">
    Serialized methods/properties
  </a>
  
    <nav class="md-nav" aria-label="Serialized methods/properties">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#error-handling" class="md-nav__link">
    Error handling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-required-serialized-methods" class="md-nav__link">
    Non-required serialized methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generic-serialized-methods" class="md-nav__link">
    Generic serialized methods
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exclude-unset-fields" class="md-nav__link">
    Exclude unset fields
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exclude-fields-with-default-value-or-none" class="md-nav__link">
    Exclude fields with default value or None
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-ordering" class="md-nav__link">
    Field ordering
  </a>
  
    <nav class="md-nav" aria-label="Field ordering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#class-level-ordering" class="md-nav__link">
    Class-level ordering
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#field-level-ordering" class="md-nav__link">
    Field-level ordering
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#typeddict-additional-properties" class="md-nav__link">
    TypedDict additional properties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#faq" class="md-nav__link">
    FAQ
  </a>
  
    <nav class="md-nav" aria-label="FAQ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#why-isnt-coercion-the-default-behavior" class="md-nav__link">
    Why isn't coercion the default behavior?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-isnt-with_fields_set-enabled-by-default" class="md-nav__link">
    Why isn't with_fields_set enabled by default?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-isnt-serialization-type-checking-enabled-by-default" class="md-nav__link">
    Why isn't serialization type checking enabled by default?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-not-use-json-library-default-fallback-parameter-for-serialization" class="md-nav__link">
    Why not use json library default fallback parameter for serialization?
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/wyfo/apischema/edit/master/docs/de_serialization.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="deserialization">(De)serialization<a class="headerlink" href="#deserialization" title="Permanent link">&para;</a></h1>
<p><em>apischema</em> aims to help with deserialization/serialization of API data, mostly JSON.</p>
<p>Let's start again with the <a href="..#example">overview example</a></p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Collection</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span><span class="p">,</span> <span class="n">uuid4</span>

<span class="kn">from</span> <span class="nn">graphql</span> <span class="kn">import</span> <span class="n">print_schema</span>
<span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">raises</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">deserialize</span><span class="p">,</span> <span class="n">serialize</span>
<span class="kn">from</span> <span class="nn">apischema.graphql</span> <span class="kn">import</span> <span class="n">graphql_schema</span>
<span class="kn">from</span> <span class="nn">apischema.json_schema</span> <span class="kn">import</span> <span class="n">deserialization_schema</span>


<span class="c1"># Define a schema with standard dataclasses</span>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Resource</span><span class="p">:</span>
    <span class="nb">id</span><span class="p">:</span> <span class="n">UUID</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">tags</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">set</span><span class="p">)</span>


<span class="c1"># Get some data</span>
<span class="n">uuid</span> <span class="o">=</span> <span class="n">uuid4</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="p">),</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;wyfo&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;some_tag&quot;</span><span class="p">]}</span>
<span class="c1"># Deserialize data</span>
<span class="n">resource</span> <span class="o">=</span> <span class="n">deserialize</span><span class="p">(</span><span class="n">Resource</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">resource</span> <span class="o">==</span> <span class="n">Resource</span><span class="p">(</span><span class="n">uuid</span><span class="p">,</span> <span class="s2">&quot;wyfo&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;some_tag&quot;</span><span class="p">})</span>
<span class="c1"># Serialize objects</span>
<span class="k">assert</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Resource</span><span class="p">,</span> <span class="n">resource</span><span class="p">)</span> <span class="o">==</span> <span class="n">data</span>
<span class="c1"># Validate during deserialization</span>
<span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>  <span class="c1"># pytest checks exception is raised</span>
    <span class="n">deserialize</span><span class="p">(</span><span class="n">Resource</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;42&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;wyfo&quot;</span><span class="p">})</span>
<span class="k">assert</span> <span class="n">err</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">errors</span> <span class="o">==</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;loc&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="s2">&quot;err&quot;</span><span class="p">:</span> <span class="s2">&quot;badly formed hexadecimal UUID string&quot;</span><span class="p">}</span>
<span class="p">]</span>
<span class="c1"># Generate JSON Schema</span>
<span class="k">assert</span> <span class="n">deserialization_schema</span><span class="p">(</span><span class="n">Resource</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s2">&quot;$schema&quot;</span><span class="p">:</span> <span class="s2">&quot;http://json-schema.org/draft/2020-12/schema#&quot;</span><span class="p">,</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
    <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;uuid&quot;</span><span class="p">},</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">},</span>
        <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;array&quot;</span><span class="p">,</span>
            <span class="s2">&quot;items&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">},</span>
            <span class="s2">&quot;uniqueItems&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">],</span>
    <span class="s2">&quot;additionalProperties&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>


<span class="c1"># Define GraphQL operations</span>
<span class="k">def</span> <span class="nf">resources</span><span class="p">(</span><span class="n">tags</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">[</span><span class="n">Resource</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
    <span class="o">...</span>


<span class="c1"># Generate GraphQL schema</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">graphql_schema</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="p">[</span><span class="n">resources</span><span class="p">],</span> <span class="n">id_types</span><span class="o">=</span><span class="p">{</span><span class="n">UUID</span><span class="p">})</span>
<span class="n">schema_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">type Query {</span>
<span class="s2">  resources(tags: [String!]): [Resource!]</span>
<span class="s2">}</span>

<span class="s2">type Resource {</span>
<span class="s2">  id: ID!</span>
<span class="s2">  name: String!</span>
<span class="s2">  tags: [String!]!</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="k">assert</span> <span class="n">print_schema</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span> <span class="o">==</span> <span class="n">schema_str</span>
</code></pre></div>

<h2 id="deserialization_1">Deserialization<a class="headerlink" href="#deserialization_1" title="Permanent link">&para;</a></h2>
<p><code>apischema.deserialize</code> deserializes Python types from JSON-like data: <code>dict</code>/<code>list</code>/<code>str</code>/<code>int</code>/<code>float</code>/<code>bool</code>/<code>None</code> â€” in short, what you get when you execute <code>json.loads</code>. Types can be dataclasses as well as <code>list[int]</code>, <code>NewType</code>s, or whatever you want (see <a href="../conversions/">conversions</a> to extend deserialization support to every type you want).</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Collection</span><span class="p">,</span> <span class="n">Mapping</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">NewType</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">deserialize</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">str</span>


<span class="n">MyInt</span> <span class="o">=</span> <span class="n">NewType</span><span class="p">(</span><span class="s2">&quot;MyInt&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">deserialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="s2">&quot;bar&quot;</span><span class="p">})</span> <span class="o">==</span> <span class="n">Foo</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">deserialize</span><span class="p">(</span><span class="n">MyInt</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">MyInt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
<span class="k">assert</span> <span class="n">deserialize</span><span class="p">(</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Collection</span><span class="p">[</span><span class="n">Foo</span><span class="p">]],</span> <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="s2">&quot;42&quot;</span><span class="p">}]})</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">Foo</span><span class="p">(</span><span class="s2">&quot;42&quot;</span><span class="p">)]</span>
<span class="p">}</span>
</code></pre></div>

<p>Deserialization performs a validation of data, based on typing annotations and other information (see <a href="../json_schema/">schema</a> and <a href="../validation/">validation</a>).</p>
<h3 id="allowed-types">Allowed types<a class="headerlink" href="#allowed-types" title="Permanent link">&para;</a></h3>
<p>In some case, e.g. a MessagePack load with raw bytes inside, some data will have other type than
JSON primitive ones. These types can be allowed using <code>allowed_types</code> parameter; it must be collection of classes, or a predicate.</p>
<p>Only non JSON primitive classes can be allowed, because <em>apischema</em> relies on a type check with <code>isinstance</code> to skip deserialization. That exclude <code>NewType</code> but also <code>TypeDict</code>. </p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">deserialize</span>

<span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">deserialize</span><span class="p">(</span>
    <span class="nb">tuple</span><span class="p">[</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="p">],</span> <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">],</span> <span class="n">allowed_types</span><span class="o">=</span><span class="p">{</span><span class="n">datetime</span><span class="p">}</span>
<span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
<span class="c1"># allowed types can also be deserialized normally from JSON types</span>
<span class="k">assert</span> <span class="n">deserialize</span><span class="p">(</span>
    <span class="nb">tuple</span><span class="p">[</span><span class="n">datetime</span><span class="p">,</span> <span class="n">datetime</span><span class="p">],</span>
    <span class="p">[</span><span class="n">start</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span> <span class="n">end</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()],</span>
    <span class="n">allowed_types</span><span class="o">=</span><span class="p">{</span><span class="n">datetime</span><span class="p">},</span>
<span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</code></pre></div>

<h3 id="strictness">Strictness<a class="headerlink" href="#strictness" title="Permanent link">&para;</a></h3>
<h4 id="coercion">Coercion<a class="headerlink" href="#coercion" title="Permanent link">&para;</a></h4>
<p><em>apischema</em> is strict by default. You ask for an integer, you have to receive an integer. </p>
<p>However, in some cases, data has to be be coerced, for example when parsing a configuration file. That can be done using <code>coerce</code> parameter; when set to <code>True</code>, all primitive types will be coerced to the expected type of the data model like the following:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">raises</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">deserialize</span>

<span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
    <span class="n">deserialize</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="s2">&quot;ok&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">deserialize</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="s2">&quot;ok&quot;</span><span class="p">,</span> <span class="n">coerce</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<p><code>bool</code> can be coerced from <code>str</code> with the following case-insensitive mapping:</p>
<table>
<thead>
<tr>
<th>False</th>
<th>True</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>f</td>
<td>t</td>
</tr>
<tr>
<td>n</td>
<td>y</td>
</tr>
<tr>
<td>no</td>
<td>yes</td>
</tr>
<tr>
<td>false</td>
<td>true</td>
</tr>
<tr>
<td>off</td>
<td>on</td>
</tr>
<tr>
<td>ko</td>
<td>ok</td>
</tr>
</tbody>
</table>
<p>The <code>coerce</code> parameter can also receive a coercion function which will then be used instead of default one.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">cast</span>

<span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">raises</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">deserialize</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">coerce</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Only coerce int to bool&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">cls</span> <span class="ow">is</span> <span class="nb">bool</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span>


<span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
    <span class="n">deserialize</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">deserialize</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="s2">&quot;ok&quot;</span><span class="p">,</span> <span class="n">coerce</span><span class="o">=</span><span class="n">coerce</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">deserialize</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">coerce</span><span class="o">=</span><span class="n">coerce</span><span class="p">)</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If coercer result is not an instance of class passed in argument, a ValidationError will be raised with an appropriate error message</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Coercer first argument is a primitive json type <code>str</code>/<code>bool</code>/<code>int</code>/<code>float</code>/<code>list</code>/<code>dict</code>/<code>type(None)</code>; it can be <code>type(None)</code>, so returning <code>cls(data)</code> will fail in this case.</p>
</div>
<h4 id="additional-properties">Additional properties<a class="headerlink" href="#additional-properties" title="Permanent link">&para;</a></h4>
<p><em>apischema</em> is strict too about the number of fields received for an <em>object</em>. In JSON schema terms, <em>apischema</em> put <code>"additionalProperties": false</code> by default (this can be configured by class with <a href="#additional-and-pattern-properties">properties field</a>). </p>
<p>This behavior can be controlled by <code>additional_properties</code> parameter. When set to <code>True</code>, it prevents the rejection of unexpected properties. </p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">raises</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">deserialize</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">str</span>


<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;other&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">}</span>
<span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
    <span class="n">deserialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">deserialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">additional_properties</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="n">Foo</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">)</span>
</code></pre></div>

<h4 id="fall-back-on-default">Fall back on default<a class="headerlink" href="#fall-back-on-default" title="Permanent link">&para;</a></h4>
<p>Validation errors can happen when deserializing an ill-formed field. However, if this field has a default value/factory, deserialization can fall back on this default; this is enabled by <code>fall_back_on_default</code> parameter. This behavior can also be configured for each field using metadata. </p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>

<span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">raises</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">deserialize</span>
<span class="kn">from</span> <span class="nn">apischema.metadata</span> <span class="kn">import</span> <span class="n">fall_back_on_default</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;bar&quot;</span>
    <span class="n">baz</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;baz&quot;</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">fall_back_on_default</span><span class="p">)</span>


<span class="k">with</span> <span class="n">raises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
    <span class="n">deserialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
<span class="k">assert</span> <span class="n">deserialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span> <span class="n">fall_back_on_default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="n">Foo</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">deserialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;baz&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span> <span class="o">==</span> <span class="n">Foo</span><span class="p">()</span>
</code></pre></div>

<h4 id="strictness-configuration">Strictness configuration<a class="headerlink" href="#strictness-configuration" title="Permanent link">&para;</a></h4>
<p><em>apischema</em> global configuration is managed through <code>apischema.settings</code> object.
It has, among other, three global variables <code>settings.additional_properties</code>, <code>settings.deserialization.coerce</code> and <code>settings.deserialization.fall_back_on_default</code> whose values are used as default parameter values for the <code>deserialize</code>; by default, <code>additional_properties=False</code>, <code>coerce=False</code> and <code>fall_back_on_default=False</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
<p><code>additional_properties</code> settings is in <code>settings.deserialization</code> because it's also used in <a href="">serialization</a>.</p>
<p>Global coercion function can be set with <code>settings.coercer</code> following this example:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">settings</span>

<span class="n">prev_coercer</span> <span class="o">=</span> <span class="n">settings</span><span class="o">.</span><span class="n">coercer</span>

<span class="k">def</span> <span class="nf">coercer</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;In case of coercion failures, try to deserialize json data&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">prev_coercer</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">err</span>

<span class="n">settings</span><span class="o">.</span><span class="n">coercer</span> <span class="o">=</span> <span class="n">coercer</span>
</code></pre></div>

<h2 id="fields-set">Fields set<a class="headerlink" href="#fields-set" title="Permanent link">&para;</a></h2>
<p>Sometimes, it can be useful to know which field has been set by the deserialization, for example in the case of <em>PATCH</em> requests, to know which field has been updated. Moreover, it is also used in serialization to limit the fields serialized (see <a href="#exclude-unset-fields">next section</a>)</p>
<p>Because <em>apischema</em> use vanilla dataclasses, this feature is not enabled by default and must be set explicitly on a per-class basis. <em>apischema</em> provides a simple API to get/set this metadata.  </p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">deserialize</span>
<span class="kn">from</span> <span class="nn">apischema.fields</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">fields_set</span><span class="p">,</span>
    <span class="n">is_set</span><span class="p">,</span>
    <span class="n">set_fields</span><span class="p">,</span>
    <span class="n">unset_fields</span><span class="p">,</span>
    <span class="n">with_fields_set</span><span class="p">,</span>
<span class="p">)</span>


<span class="c1"># This decorator enable the feature</span>
<span class="nd">@with_fields_set</span>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">baz</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>


<span class="c1"># Retrieve fields set</span>
<span class="n">foo1</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">fields_set</span><span class="p">(</span><span class="n">foo1</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">}</span>
<span class="n">foo2</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">fields_set</span><span class="p">(</span><span class="n">foo2</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">}</span>
<span class="c1"># Test fields individually (with autocompletion and refactoring)</span>
<span class="k">assert</span> <span class="n">is_set</span><span class="p">(</span><span class="n">foo1</span><span class="p">)</span><span class="o">.</span><span class="n">baz</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">is_set</span><span class="p">(</span><span class="n">foo2</span><span class="p">)</span><span class="o">.</span><span class="n">baz</span>
<span class="c1"># Mark fields as set/unset</span>
<span class="n">set_fields</span><span class="p">(</span><span class="n">foo2</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">fields_set</span><span class="p">(</span><span class="n">foo2</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">}</span>
<span class="n">unset_fields</span><span class="p">(</span><span class="n">foo2</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">fields_set</span><span class="p">(</span><span class="n">foo2</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">}</span>
<span class="n">set_fields</span><span class="p">(</span><span class="n">foo2</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">fields_set</span><span class="p">(</span><span class="n">foo2</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;baz&quot;</span><span class="p">}</span>
<span class="c1"># Fields modification are taken in account</span>
<span class="n">foo2</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">assert</span> <span class="n">fields_set</span><span class="p">(</span><span class="n">foo2</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">}</span>
<span class="c1"># Because deserialization use normal constructor, it works with the feature</span>
<span class="n">foo3</span> <span class="o">=</span> <span class="n">deserialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
<span class="k">assert</span> <span class="n">fields_set</span><span class="p">(</span><span class="n">foo3</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">}</span>
</code></pre></div>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code>with_fields_set</code> decorator MUST be put above <code>dataclass</code> one. This is because both of them modify <code>__init__</code> method, but only the first is built to take the second in account.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code>dataclasses.replace</code> works by setting all the fields of the replaced object. Because of this issue, <em>apischema</em> provides a little wrapper <code>apischema.dataclasses.replace</code>.</p>
</div>
<h2 id="serialization">Serialization<a class="headerlink" href="#serialization" title="Permanent link">&para;</a></h2>
<p><code>apischema.serialize</code> is used to serialize Python objects to JSON-like data. Contrary to <code>apischema.deserialize</code>, Python type can be omitted; in this case, the object will be serialized with an <code>typing.Any</code> type, i.e. the class of the serialized object will be used.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">serialize</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">assert</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">Foo</span><span class="p">(</span><span class="s2">&quot;baz&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="s2">&quot;baz&quot;</span><span class="p">}</span>
<span class="k">assert</span> <span class="n">serialize</span><span class="p">(</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="p">(</span>
    <span class="n">serialize</span><span class="p">(</span><span class="n">Any</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">)})</span>
    <span class="o">==</span> <span class="n">serialize</span><span class="p">({</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">)})</span>
    <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="mi">42</span><span class="p">]}</span>
<span class="p">)</span>
<span class="k">assert</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">(</span><span class="s2">&quot;baz&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="s2">&quot;baz&quot;</span><span class="p">}</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Omitting type with <code>serialize</code> can have unwanted side effects, as it makes loose any type annotations of the serialized object. In fact, generic specialization as well as PEP 593 annotations cannot be retrieved from an object instance; <a href="../conversions/">conversions</a> can also be impacted</p>
<p>That's why it's advisable to pass the type when it is available.</p>
</div>
<h3 id="type-checking">Type checking<a class="headerlink" href="#type-checking" title="Permanent link">&para;</a></h3>
<p>Serialization can be configured using <code>check_type</code> (default to <code>False</code>) and <code>fall_back_on_any</code> (default to <code>False</code>) parameters. If <code>check_type</code> is <code>True</code>, the serialized object type will be checked to match the serialized type.
If it doesn't, <code>fall_back_on_any</code> allows bypassing the serialized type to use <code>typing.Any</code> instead, i.e. to use the serialized object class.</p>
<p>The default values of these parameters can be modified through <code>apischema.settings.serialization.check_type</code> and <code>apischema.settings.serialization.fall_back_on_any</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><em>apischema</em> relies on typing annotations, and assumes that the code is well statically type-checked. That's why it doesn't add the overhead of type checking by default (it's more than 10% performance impact).</p>
</div>
<h3 id="serialized-methodsproperties">Serialized methods/properties<a class="headerlink" href="#serialized-methodsproperties" title="Permanent link">&para;</a></h3>
<p><em>apischema</em> can execute methods/properties during serialization and add the computed values with the other fields values; just put <code>apischema.serialized</code> decorator on top of methods/properties you want to be serialized.</p>
<p>The function name is used unless an alias is given in decorator argument.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">serialize</span><span class="p">,</span> <span class="n">serialized</span>
<span class="kn">from</span> <span class="nn">apischema.json_schema</span> <span class="kn">import</span> <span class="n">serialization_schema</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="nd">@serialized</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="c1"># Serialized method can have default argument</span>
    <span class="nd">@serialized</span>
    <span class="k">def</span> <span class="nf">baz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">some_arg_with_default</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">some_arg_with_default</span>

    <span class="nd">@serialized</span><span class="p">(</span><span class="s2">&quot;aliased&quot;</span><span class="p">)</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">with_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">2</span>


<span class="c1"># Serialized method can also be defined outside class,</span>
<span class="c1"># but first parameter must be annotated</span>
<span class="nd">@serialized</span>
<span class="k">def</span> <span class="nf">function</span><span class="p">(</span><span class="n">foo</span><span class="p">:</span> <span class="n">Foo</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="mi">3</span>


<span class="k">assert</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">Foo</span><span class="p">())</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;aliased&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="k">assert</span> <span class="n">serialization_schema</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s2">&quot;$schema&quot;</span><span class="p">:</span> <span class="s2">&quot;http://json-schema.org/draft/2020-12/schema#&quot;</span><span class="p">,</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
    <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;aliased&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">},</span>
        <span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">},</span>
        <span class="s2">&quot;baz&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">},</span>
        <span class="s2">&quot;function&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">},</span>
    <span class="p">},</span>
    <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">,</span> <span class="s2">&quot;aliased&quot;</span><span class="p">,</span> <span class="s2">&quot;function&quot;</span><span class="p">],</span>
    <span class="s2">&quot;additionalProperties&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Serialized methods must not have parameters without default, as <em>apischema</em> needs to execute them without arguments</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Overriding of a serialized method in a subclass will also override the serialization of the subclass.</p>
</div>
<h4 id="error-handling">Error handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h4>
<p>Errors occurring in serialized methods can be caught in a dedicated error handler registered with <code>error_handler</code> parameter. This function takes in parameters the exception, the object and the alias of the serialized method; it can return a new value or raise the current or another exception â€” it can for example be used to log errors without throwing the complete serialization.</p>
<p>The resulting serialization type will be a <code>Union</code> of the normal type and the error handling type; if the error handler always raises, use <a href="https://docs.python.org/3/library/typing.html#typing.NoReturn"><code>typing.NoReturn</code></a> annotation.</p>
<p><code>error_handler=None</code> correspond to a default handler which only return <code>None</code> â€” exception is thus discarded and serialization type becomes <code>Optional</code>.</p>
<p>The error handler is only executed by <em>apischema</em> serialization process, it's not added to the function, so this one can be executed normally and raise an exception in the rest of your code.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">logging</span> <span class="kn">import</span> <span class="n">getLogger</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">serialize</span><span class="p">,</span> <span class="n">serialized</span>
<span class="kn">from</span> <span class="nn">apischema.json_schema</span> <span class="kn">import</span> <span class="n">serialization_schema</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">log_error</span><span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">alias</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
        <span class="s2">&quot;Serialization error in </span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">alias</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="n">error</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="nd">@serialized</span><span class="p">(</span><span class="n">error_handler</span><span class="o">=</span><span class="n">log_error</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Some error&quot;</span><span class="p">)</span>


<span class="k">assert</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">Foo</span><span class="p">())</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>  <span class="c1"># Logs &quot;Serialization error in Foo.bar&quot;</span>
<span class="k">assert</span> <span class="n">serialization_schema</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s2">&quot;$schema&quot;</span><span class="p">:</span> <span class="s2">&quot;http://json-schema.org/draft/2020-12/schema#&quot;</span><span class="p">,</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
    <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="s2">&quot;null&quot;</span><span class="p">]}},</span>
    <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">],</span>
    <span class="s2">&quot;additionalProperties&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="non-required-serialized-methods">Non-required serialized methods<a class="headerlink" href="#non-required-serialized-methods" title="Permanent link">&para;</a></h4>
<p>Serialized methods (or their error handler) can return <code>apischema.Undefined</code>, in which case the property will not be included into the serialization; accordingly, the property loses the <em>required</em> qualification in the JSON schema.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">Undefined</span><span class="p">,</span> <span class="n">UndefinedType</span><span class="p">,</span> <span class="n">serialize</span><span class="p">,</span> <span class="n">serialized</span>
<span class="kn">from</span> <span class="nn">apischema.json_schema</span> <span class="kn">import</span> <span class="n">serialization_schema</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="nd">@serialized</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">UndefinedType</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Undefined</span>


<span class="k">assert</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">Foo</span><span class="p">())</span> <span class="o">==</span> <span class="p">{}</span>
<span class="k">assert</span> <span class="n">serialization_schema</span><span class="p">(</span><span class="n">Foo</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s2">&quot;$schema&quot;</span><span class="p">:</span> <span class="s2">&quot;http://json-schema.org/draft/2020-12/schema#&quot;</span><span class="p">,</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
    <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">}},</span>
    <span class="s2">&quot;additionalProperties&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="generic-serialized-methods">Generic serialized methods<a class="headerlink" href="#generic-serialized-methods" title="Permanent link">&para;</a></h4>
<p>Serialized methods of generic classes get the right type when their owning class is specialized.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">serialized</span>
<span class="kn">from</span> <span class="nn">apischema.json_schema</span> <span class="kn">import</span> <span class="n">serialization_schema</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">)</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="c1"># serialized decorator for methods of generic class is not supported in Python 3.6</span>
    <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
        <span class="o">...</span>


<span class="n">serialized</span><span class="p">(</span><span class="n">Foo</span><span class="o">.</span><span class="n">bar</span><span class="p">)</span>


<span class="nd">@serialized</span>
<span class="k">def</span> <span class="nf">baz</span><span class="p">(</span><span class="n">foo</span><span class="p">:</span> <span class="n">Foo</span><span class="p">[</span><span class="n">U</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">U</span><span class="p">:</span>
    <span class="o">...</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FooInt</span><span class="p">(</span><span class="n">Foo</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
    <span class="o">...</span>


<span class="k">assert</span> <span class="p">(</span>
    <span class="n">serialization_schema</span><span class="p">(</span><span class="n">Foo</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span>
    <span class="o">==</span> <span class="n">serialization_schema</span><span class="p">(</span><span class="n">FooInt</span><span class="p">)</span>
    <span class="o">==</span> <span class="p">{</span>
        <span class="s2">&quot;$schema&quot;</span><span class="p">:</span> <span class="s2">&quot;http://json-schema.org/draft/2020-12/schema#&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
        <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">},</span> <span class="s2">&quot;baz&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">}},</span>
        <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">],</span>
        <span class="s2">&quot;additionalProperties&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div>

<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code>serialized</code> cannot decorate methods of <code>Generic</code> classes in Python 3.6, it has to be used outside of class.</p>
</div>
<h3 id="exclude-unset-fields">Exclude unset fields<a class="headerlink" href="#exclude-unset-fields" title="Permanent link">&para;</a></h3>
<p>When a class has a lot of optional fields, it can be convenient to not include all of them, to avoid a bunch of useless fields in your serialized data.
Using the previous feature of <a href="#fields-set">fields set tracking</a>, <code>serialize</code> can exclude unset fields using its <code>exclude_unset</code> parameter or <code>settings.serialization.exclude_unset</code> (default is <code>True</code>).</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">serialize</span>
<span class="kn">from</span> <span class="nn">apischema.fields</span> <span class="kn">import</span> <span class="n">with_fields_set</span>


<span class="c1"># Decorator needed to benefit from the feature</span>
<span class="nd">@with_fields_set</span>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">baz</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">assert</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
<span class="k">assert</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">exclude_unset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;baz&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As written in comment in the example, <code>with_fields_set</code> is necessary to benefit from the feature. If the dataclass don't use it, the feature will have no effect.</p>
</div>
<p>Sometimes, some fields must be serialized, even with their default value; this behavior can be enforced using field metadata. With it, a field will be marked as set even if its default value is used at initialization.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">serialize</span>
<span class="kn">from</span> <span class="nn">apischema.fields</span> <span class="kn">import</span> <span class="n">with_fields_set</span>
<span class="kn">from</span> <span class="nn">apischema.metadata</span> <span class="kn">import</span> <span class="n">default_as_set</span>


<span class="c1"># Decorator needed to benefit from the feature</span>
<span class="nd">@with_fields_set</span>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">default_as_set</span><span class="p">)</span>


<span class="k">assert</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">Foo</span><span class="p">())</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
<span class="k">assert</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This metadata has effect only in combination with <code>with_fields_set</code> decorator.</p>
</div>
<h3 id="exclude-fields-with-default-value-or-none">Exclude fields with default value or <code>None</code><a class="headerlink" href="#exclude-fields-with-default-value-or-none" title="Permanent link">&para;</a></h3>
<p>Fields metadata <a href="../data_model/#skip-field-serialization-depending-on-condition"><code>apischema.skip</code></a> already allows skipping fields serialization depending on a condition, for example if the field is <code>None</code> or equal to its default value. However, it must be added on each concerned fields, and that can be tedious when you want to set that behavior globally.</p>
<p>That's why <em>apischema</em> provides the two following settings:</p>
<ul>
<li><code>settings.serialization.exclude_defaults</code>: whether fields which are equal to their default values should be excluded from serialization; default <code>False</code></li>
<li><code>settings.serialization.exclude_none</code>: whether fields which are equal to <code>None</code> should be excluded from serialization; default <code>False</code></li>
</ul>
<p>These settings can also be set directly using <code>serialize</code> parameters, like in the following example:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">serialize</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">baz</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>


<span class="k">assert</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">Foo</span><span class="p">(),</span> <span class="n">exclude_defaults</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="p">{}</span>
<span class="k">assert</span> <span class="n">serialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">Foo</span><span class="p">(),</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s2">&quot;bar&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</code></pre></div>

<h3 id="field-ordering">Field ordering<a class="headerlink" href="#field-ordering" title="Permanent link">&para;</a></h3>
<p>Usually, JSON object properties are unordered, but sometimes, order does matter. By default, fields, are ordered according to their declaration; serialized methods are appended after the fields.</p>
<p>However, it's possible to change the ordering using <code>apischema.order</code>.</p>
<h4 id="class-level-ordering">Class-level ordering<a class="headerlink" href="#class-level-ordering" title="Permanent link">&para;</a></h4>
<p><code>order</code> can be used to decorate a class with the field ordered as expected:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">order</span><span class="p">,</span> <span class="n">serialize</span>


<span class="nd">@order</span><span class="p">([</span><span class="s2">&quot;baz&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="s2">&quot;biz&quot;</span><span class="p">])</span>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="n">bar</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">baz</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">biz</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">assert</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">serialize</span><span class="p">(</span><span class="n">Foo</span><span class="p">,</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)))</span> <span class="o">==</span> <span class="s1">&#39;{&quot;baz&quot;: 0, &quot;bar&quot;: 0, &quot;biz&quot;: &quot;&quot;}&#39;</span>
</code></pre></div>

<h4 id="field-level-ordering">Field-level ordering<a class="headerlink" href="#field-level-ordering" title="Permanent link">&para;</a></h4>
<p>Each field has an order "value" (0 by default), and ordering is done by sorting fields using this value; if several fields have the same order value, they are sorted by their declaration order. For instance, assigning <code>-1</code> to a field will put it before every other fields, and <code>999</code> will surely put it at the end.</p>
<p>This order value is set using <code>order</code>, this time as a field metadata (or passed to <code>order</code> argument of <a href="#serialized-methodsproperties">serialized methods/properties</a>). It has the following overloaded signature:</p>
<ul>
<li><code>order(value: int, /)</code>: set the order value of the field</li>
<li><code>order(*, after)</code>: ignore the order value and put the field after the given field/method/property</li>
<li><code>order(*, before)</code>: ignore the order value and put the field before the given field/method/property</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>after</code> and <code>before</code> can be raw strings, but also dataclass fields, methods or properties.</p>
</div>
<p>Also, <code>order</code> can again be used as class decorator to override ordering metadata, by passing this time a mapping of field with their overridden order.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>

<span class="kn">from</span> <span class="nn">apischema</span> <span class="kn">import</span> <span class="n">order</span><span class="p">,</span> <span class="n">serialize</span><span class="p">,</span> <span class="n">serialized</span>


<span class="nd">@order</span><span class="p">({</span><span class="s2">&quot;trigram&quot;</span><span class="p">:</span> <span class="n">order</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)})</span>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">User</span><span class="p">:</span>
    <span class="n">firstname</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">lastname</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">address</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">order</span><span class="p">(</span><span class="n">after</span><span class="o">=</span><span class="s2">&quot;birthdate&quot;</span><span class="p">))</span>
    <span class="n">birthdate</span><span class="p">:</span> <span class="n">date</span> <span class="o">=</span> <span class="n">field</span><span class="p">()</span>

    <span class="nd">@serialized</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">trigram</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">firstname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastname</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastname</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="nd">@serialized</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">(</span><span class="n">before</span><span class="o">=</span><span class="n">birthdate</span><span class="p">))</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">age</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">age</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">year</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">birthdate</span><span class="o">.</span><span class="n">year</span>
        <span class="k">if</span> <span class="n">age</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">birthdate</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">birthdate</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">age</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">age</span>


<span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="s2">&quot;Harry&quot;</span><span class="p">,</span> <span class="s2">&quot;Potter&quot;</span><span class="p">,</span> <span class="s2">&quot;London&quot;</span><span class="p">,</span> <span class="n">date</span><span class="p">(</span><span class="mi">1980</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">31</span><span class="p">))</span>
<span class="n">dump</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">    &quot;trigram&quot;: &quot;hpr&quot;,</span>
<span class="s2">    &quot;firstname&quot;: &quot;Harry&quot;,</span>
<span class="s2">    &quot;lastname&quot;: &quot;Potter&quot;,</span>
<span class="s2">    &quot;age&quot;: 41,</span>
<span class="s2">    &quot;birthdate&quot;: &quot;1980-07-31&quot;,</span>
<span class="s2">    &quot;address&quot;: &quot;London&quot;</span>
<span class="s2">}&quot;&quot;&quot;</span>
<span class="k">assert</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">serialize</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">user</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="n">dump</span>
</code></pre></div>

<h3 id="typeddict-additional-properties">TypedDict additional properties<a class="headerlink" href="#typeddict-additional-properties" title="Permanent link">&para;</a></h3>
<p><code>TypedDict</code> can contain additional keys, which are not serialized by default. Setting <code>additional_properties</code> parameter to <code>True</code> (or <code>apischema.settings.additional_properties</code>) will toggle on their serialization (without aliasing).</p>
<h2 id="faq">FAQ<a class="headerlink" href="#faq" title="Permanent link">&para;</a></h2>
<h4 id="why-isnt-coercion-the-default-behavior">Why isn't coercion the default behavior?<a class="headerlink" href="#why-isnt-coercion-the-default-behavior" title="Permanent link">&para;</a></h4>
<p>Because ill-formed data can be symptomatic of deeper issues, it has been decided that highlighting them would be better than hiding them. By the way, this is easily globally configurable.</p>
<h4 id="why-isnt-with_fields_set-enabled-by-default">Why isn't <code>with_fields_set</code> enabled by default?<a class="headerlink" href="#why-isnt-with_fields_set-enabled-by-default" title="Permanent link">&para;</a></h4>
<p>It's true that this feature has the little cost of adding a decorator everywhere. However, keeping dataclass decorator allows IDEs/linters/type checkers/etc. to handle the class as such, so there is no need to develop a plugin for them. Standard compliance can be worth the additional decorator. (And little overhead can be avoided when not useful)</p>
<h4 id="why-isnt-serialization-type-checking-enabled-by-default">Why isn't serialization type checking enabled by default?<a class="headerlink" href="#why-isnt-serialization-type-checking-enabled-by-default" title="Permanent link">&para;</a></h4>
<p>Type checking has a runtime cost, which means poorer performance. Moreover, as explained in <a href="../performance_and_benchmark/#serialization-passthrough">performances section</a>, it prevents "passthrough" optimization. At last, code is supposed to be statically verified, and thus types already checked. (If some silly things are done and leads to have unsupported types passed to the JSON library, an error will be raised anyway).</p>
<p>Runtime type checking is more a development feature, which could for example be with <code>apischema.settings.serialization.check_type = __debug__</code>.</p>
<h4 id="why-not-use-json-library-default-fallback-parameter-for-serialization">Why not use json library <code>default</code> fallback parameter for serialization?<a class="headerlink" href="#why-not-use-json-library-default-fallback-parameter-for-serialization" title="Permanent link">&para;</a></h4>
<p>Some <em>apischema</em> features like <a href="../conversions/">conversions</a> can simply not be implemented with <code>default</code> fallback. By the way, <em>apischema</em> can perform <a href="../performance_and_benchmark/#passing-through-is-not-always-faster">surprisingly better</a> than using <code>default</code>.</p>
<p>However, <code>default</code> can be used in combination with <a href="../performance_and_benchmark/#serialization-passthrough">passthrough optimization</a> when needed to improve performance.  </p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../data_model/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Data model" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Data model
            </div>
          </div>
        </a>
      
      
        
        <a href="../json_schema/" class="md-footer__link md-footer__link--next" aria-label="Next: JSON schema" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              JSON schema
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.fcfe8b6d.min.js", "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.b1047164.min.js"></script>
      
    
  </body>
</html>